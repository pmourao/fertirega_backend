{
  "entityType": "WIDGETS_BUNDLE",
  "entity": {
    "alias": "fertirega_widgets",
    "title": "FertiRega Widgets",
    "description": "Custom widgets for FertiRega irrigation management system",
    "image": null,
    "order": 0
  },
  "widgets": [
    {
      "isSystemType": false,
      "bundleAlias": "fertirega_widgets",
      "typeAlias": "fertirega_valvecontrol_0",
      "type": "RPC",
      "title": "FertiRega Valve 0 Control",
      "description": "Toggle switch control for Valve 0 with ChirpStack HTTP API",
      "image": null,
      "sizeX": 4,
      "sizeY": 3,
      "resources": [],
      "templateHtml": "<div class=\"valve-control-container\">\n  <div class=\"valve-header\">\n    <h3>Valve 0</h3>\n    <span class=\"valve-status\" ng-class=\"{'valve-open': valveStatus === 1, 'valve-closed': valveStatus === 0}\">{{valveStatusText}}</span>\n  </div>\n  <div class=\"switch-container\">\n    <label class=\"switch\">\n      <input type=\"checkbox\" ng-model=\"valveChecked\" ng-change=\"toggleValve()\">\n      <span class=\"slider round\"></span>\n    </label>\n  </div>\n  <div class=\"valve-info\">\n    <p>Last Updated: {{lastUpdate | date:'short'}}</p>\n  </div>\n</div>",
      "templateCss": ".valve-control-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 20px;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  height: 100%;\n}\n\n.valve-header {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.valve-header h3 {\n  margin: 0;\n  font-size: 18px;\n  font-weight: 500;\n  color: #333;\n}\n\n.valve-status {\n  padding: 4px 12px;\n  border-radius: 12px;\n  font-size: 12px;\n  font-weight: 500;\n}\n\n.valve-open {\n  background: #4caf50;\n  color: white;\n}\n\n.valve-closed {\n  background: #9e9e9e;\n  color: white;\n}\n\n.switch-container {\n  margin: 20px 0;\n}\n\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 80px;\n  height: 40px;\n}\n\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #ccc;\n  transition: .4s;\n}\n\n.slider:before {\n  position: absolute;\n  content: \"\";\n  height: 32px;\n  width: 32px;\n  left: 4px;\n  bottom: 4px;\n  background-color: white;\n  transition: .4s;\n}\n\ninput:checked + .slider {\n  background-color: #4caf50;\n}\n\ninput:checked + .slider:before {\n  transform: translateX(40px);\n}\n\n.slider.round {\n  border-radius: 40px;\n}\n\n.slider.round:before {\n  border-radius: 50%;\n}\n\n.valve-info {\n  margin-top: 20px;\n  text-align: center;\n  color: #666;\n  font-size: 12px;\n}",
      "controllerScript": "self.onInit = function() {\n    self.ctx.$scope.valveStatus = 0;\n    self.ctx.$scope.valveChecked = false;\n    self.ctx.$scope.valveStatusText = 'Closed';\n    self.ctx.$scope.lastUpdate = new Date();\n    \n    // Subscribe to valve status\n    self.ctx.defaultSubscription.subscribe();\n    \n    self.ctx.$scope.toggleValve = function() {\n        var action = self.ctx.$scope.valveChecked ? 1 : 0;\n        var actionText = action === 1 ? 'open' : 'close';\n        \n        // Get device EUI from entity name or attributes\n        var deviceName = self.ctx.defaultSubscription.entityName;\n        var devEui = self.ctx.defaultSubscription.entityId.id;\n        \n        // Try to get EUI from attributes if available\n        if (self.ctx.datasources && self.ctx.datasources[0] && self.ctx.datasources[0].entity) {\n            var entity = self.ctx.datasources[0].entity;\n            if (entity.name && entity.name.startsWith('eui-')) {\n                devEui = entity.name.replace('eui-', '');\n            }\n        }\n        \n        // Encode command to base64\n        var valve = 0; // Valve 0\n        var buffer = [valve, action];\n        var base64 = btoa(String.fromCharCode.apply(null, buffer));\n        \n        var payload = {\n            queueItem: {\n                confirmed: true,\n                data: base64,\n                fPort: 2\n            }\n        };\n        \n        // Send HTTP request to ChirpStack\n        var url = 'http://100.92.66.20:8080/api/devices/' + devEui + '/queue';\n        \n        self.ctx.http.post(url, payload, {\n            headers: {\n                'Content-Type': 'application/json',\n                'Grpc-Metadata-Authorization': 'Bearer YOUR_API_KEY_HERE'\n            }\n        }).subscribe(\n            function(response) {\n                self.ctx.$scope.valveStatus = action;\n                self.ctx.$scope.valveStatusText = action === 1 ? 'Open' : 'Closed';\n                self.ctx.$scope.lastUpdate = new Date();\n                self.ctx.showSuccessToast('Valve 0 command sent: ' + actionText);\n            },\n            function(error) {\n                self.ctx.$scope.valveChecked = !self.ctx.$scope.valveChecked;\n                self.ctx.showErrorToast('Failed to send valve command: ' + error.message);\n            }\n        );\n    };\n};\n\nself.onDataUpdated = function() {\n    if (self.ctx.data && self.ctx.data.length > 0) {\n        var data = self.ctx.data[0];\n        if (data.data && data.data.length > 0) {\n            var latestData = data.data[0];\n            if (latestData[1] !== undefined) {\n                self.ctx.$scope.valveStatus = latestData[1];\n                self.ctx.$scope.valveChecked = latestData[1] === 1;\n                self.ctx.$scope.valveStatusText = latestData[1] === 1 ? 'Open' : 'Closed';\n                self.ctx.$scope.lastUpdate = new Date(latestData[0]);\n                self.ctx.detectChanges();\n            }\n        }\n    }\n};\n\nself.onDestroy = function() {\n};"
    },
    {
      "isSystemType": false,
      "bundleAlias": "fertirega_widgets",
      "typeAlias": "fertirega_valvecontrol_1",
      "type": "RPC",
      "title": "FertiRega Valve 1 Control",
      "description": "Toggle switch control for Valve 1 with ChirpStack HTTP API",
      "image": null,
      "sizeX": 4,
      "sizeY": 3,
      "resources": [],
      "templateHtml": "<div class=\"valve-control-container\">\n  <div class=\"valve-header\">\n    <h3>Valve 1</h3>\n    <span class=\"valve-status\" ng-class=\"{'valve-open': valveStatus === 1, 'valve-closed': valveStatus === 0}\">{{valveStatusText}}</span>\n  </div>\n  <div class=\"switch-container\">\n    <label class=\"switch\">\n      <input type=\"checkbox\" ng-model=\"valveChecked\" ng-change=\"toggleValve()\">\n      <span class=\"slider round\"></span>\n    </label>\n  </div>\n  <div class=\"valve-info\">\n    <p>Last Updated: {{lastUpdate | date:'short'}}</p>\n  </div>\n</div>",
      "templateCss": ".valve-control-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 20px;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  height: 100%;\n}\n\n.valve-header {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.valve-header h3 {\n  margin: 0;\n  font-size: 18px;\n  font-weight: 500;\n  color: #333;\n}\n\n.valve-status {\n  padding: 4px 12px;\n  border-radius: 12px;\n  font-size: 12px;\n  font-weight: 500;\n}\n\n.valve-open {\n  background: #4caf50;\n  color: white;\n}\n\n.valve-closed {\n  background: #9e9e9e;\n  color: white;\n}\n\n.switch-container {\n  margin: 20px 0;\n}\n\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 80px;\n  height: 40px;\n}\n\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #ccc;\n  transition: .4s;\n}\n\n.slider:before {\n  position: absolute;\n  content: \"\";\n  height: 32px;\n  width: 32px;\n  left: 4px;\n  bottom: 4px;\n  background-color: white;\n  transition: .4s;\n}\n\ninput:checked + .slider {\n  background-color: #4caf50;\n}\n\ninput:checked + .slider:before {\n  transform: translateX(40px);\n}\n\n.slider.round {\n  border-radius: 40px;\n}\n\n.slider.round:before {\n  border-radius: 50%;\n}\n\n.valve-info {\n  margin-top: 20px;\n  text-align: center;\n  color: #666;\n  font-size: 12px;\n}",
      "controllerScript": "self.onInit = function() {\n    self.ctx.$scope.valveStatus = 0;\n    self.ctx.$scope.valveChecked = false;\n    self.ctx.$scope.valveStatusText = 'Closed';\n    self.ctx.$scope.lastUpdate = new Date();\n    \n    self.ctx.defaultSubscription.subscribe();\n    \n    self.ctx.$scope.toggleValve = function() {\n        var action = self.ctx.$scope.valveChecked ? 1 : 0;\n        var actionText = action === 1 ? 'open' : 'close';\n        \n        var deviceName = self.ctx.defaultSubscription.entityName;\n        var devEui = self.ctx.defaultSubscription.entityId.id;\n        \n        if (self.ctx.datasources && self.ctx.datasources[0] && self.ctx.datasources[0].entity) {\n            var entity = self.ctx.datasources[0].entity;\n            if (entity.name && entity.name.startsWith('eui-')) {\n                devEui = entity.name.replace('eui-', '');\n            }\n        }\n        \n        var valve = 1; // Valve 1\n        var buffer = [valve, action];\n        var base64 = btoa(String.fromCharCode.apply(null, buffer));\n        \n        var payload = {\n            queueItem: {\n                confirmed: true,\n                data: base64,\n                fPort: 2\n            }\n        };\n        \n        var url = 'http://100.92.66.20:8080/api/devices/' + devEui + '/queue';\n        \n        self.ctx.http.post(url, payload, {\n            headers: {\n                'Content-Type': 'application/json',\n                'Grpc-Metadata-Authorization': 'Bearer YOUR_API_KEY_HERE'\n            }\n        }).subscribe(\n            function(response) {\n                self.ctx.$scope.valveStatus = action;\n                self.ctx.$scope.valveStatusText = action === 1 ? 'Open' : 'Closed';\n                self.ctx.$scope.lastUpdate = new Date();\n                self.ctx.showSuccessToast('Valve 1 command sent: ' + actionText);\n            },\n            function(error) {\n                self.ctx.$scope.valveChecked = !self.ctx.$scope.valveChecked;\n                self.ctx.showErrorToast('Failed to send valve command: ' + error.message);\n            }\n        );\n    };\n};\n\nself.onDataUpdated = function() {\n    if (self.ctx.data && self.ctx.data.length > 0) {\n        var data = self.ctx.data[0];\n        if (data.data && data.data.length > 0) {\n            var latestData = data.data[0];\n            if (latestData[1] !== undefined) {\n                self.ctx.$scope.valveStatus = latestData[1];\n                self.ctx.$scope.valveChecked = latestData[1] === 1;\n                self.ctx.$scope.valveStatusText = latestData[1] === 1 ? 'Open' : 'Closed';\n                self.ctx.$scope.lastUpdate = new Date(latestData[0]);\n                self.ctx.detectChanges();\n            }\n        }\n    }\n};\n\nself.onDestroy = function() {\n};"
    },
    {
      "isSystemType": false,
      "bundleAlias": "fertirega_widgets",
      "typeAlias": "fertirega_deviceattributes",
      "type": "latest",
      "title": "FertiRega Device Attributes",
      "description": "Display device attributes and status information",
      "image": null,
      "sizeX": 6,
      "sizeY": 3,
      "resources": [],
      "templateHtml": "<div class=\"device-attributes-container\">\n  <div class=\"attribute-row\">\n    <div class=\"attribute-item\">\n      <span class=\"attribute-icon\">\ud83d\udccd</span>\n      <div class=\"attribute-content\">\n        <span class=\"attribute-label\">Location</span>\n        <span class=\"attribute-value\">{{latitude | number:6}}, {{longitude | number:6}}</span>\n      </div>\n    </div>\n    <div class=\"attribute-item\">\n      <span class=\"attribute-icon\">\ud83d\udd0b</span>\n      <div class=\"attribute-content\">\n        <span class=\"attribute-label\">Battery</span>\n        <span class=\"attribute-value\">{{battery}}%</span>\n      </div>\n    </div>\n  </div>\n  <div class=\"attribute-row\">\n    <div class=\"attribute-item\">\n      <span class=\"attribute-icon\">\ud83c\udf21\ufe0f</span>\n      <div class=\"attribute-content\">\n        <span class=\"attribute-label\">Temperature</span>\n        <span class=\"attribute-value\">{{temperature | number:1}}\u00b0C</span>\n      </div>\n    </div>\n    <div class=\"attribute-item\">\n      <span class=\"attribute-icon\">\ud83d\udca7</span>\n      <div class=\"attribute-content\">\n        <span class=\"attribute-label\">Humidity</span>\n        <span class=\"attribute-value\">{{humidity | number:1}}%</span>\n      </div>\n    </div>\n  </div>\n  <div class=\"attribute-row\">\n    <div class=\"attribute-item\">\n      <span class=\"attribute-icon\">\u23f0</span>\n      <div class=\"attribute-content\">\n        <span class=\"attribute-label\">Last Activity</span>\n        <span class=\"attribute-value\">{{lastActivity | date:'short'}}</span>\n      </div>\n    </div>\n    <div class=\"attribute-item\">\n      <span class=\"attribute-icon\" ng-class=\"{'status-active': isActive, 'status-inactive': !isActive}\">\u25cf</span>\n      <div class=\"attribute-content\">\n        <span class=\"attribute-label\">Status</span>\n        <span class=\"attribute-value\">{{statusText}}</span>\n      </div>\n    </div>\n  </div>\n</div>",
      "templateCss": ".device-attributes-container {\n  padding: 16px;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  height: 100%;\n}\n\n.attribute-row {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 12px;\n}\n\n.attribute-row:last-child {\n  margin-bottom: 0;\n}\n\n.attribute-item {\n  display: flex;\n  align-items: center;\n  flex: 1;\n  padding: 8px;\n  background: #f5f5f5;\n  border-radius: 6px;\n  margin: 0 4px;\n}\n\n.attribute-item:first-child {\n  margin-left: 0;\n}\n\n.attribute-item:last-child {\n  margin-right: 0;\n}\n\n.attribute-icon {\n  font-size: 24px;\n  margin-right: 12px;\n}\n\n.status-active {\n  color: #4caf50;\n}\n\n.status-inactive {\n  color: #f44336;\n}\n\n.attribute-content {\n  display: flex;\n  flex-direction: column;\n}\n\n.attribute-label {\n  font-size: 11px;\n  color: #666;\n  text-transform: uppercase;\n  margin-bottom: 2px;\n}\n\n.attribute-value {\n  font-size: 14px;\n  color: #333;\n  font-weight: 500;\n}",
      "controllerScript": "self.onInit = function() {\n    self.ctx.$scope.latitude = 0;\n    self.ctx.$scope.longitude = 0;\n    self.ctx.$scope.battery = 0;\n    self.ctx.$scope.temperature = 0;\n    self.ctx.$scope.humidity = 0;\n    self.ctx.$scope.lastActivity = new Date();\n    self.ctx.$scope.isActive = false;\n    self.ctx.$scope.statusText = 'Offline';\n};\n\nself.onDataUpdated = function() {\n    if (self.ctx.data && self.ctx.data.length > 0) {\n        for (var i = 0; i < self.ctx.data.length; i++) {\n            var dataItem = self.ctx.data[i];\n            if (dataItem.data && dataItem.data.length > 0) {\n                var latestData = dataItem.data[0];\n                var dataKey = dataItem.dataKey.name;\n                \n                switch(dataKey) {\n                    case 'Server_Lat':\n                        self.ctx.$scope.latitude = latestData[1];\n                        break;\n                    case 'Server_Lon':\n                        self.ctx.$scope.longitude = latestData[1];\n                        break;\n                    case 'battery_percentage':\n                        self.ctx.$scope.battery = latestData[1];\n                        break;\n                    case 'temperature':\n                        self.ctx.$scope.temperature = latestData[1];\n                        break;\n                    case 'humidity':\n                        self.ctx.$scope.humidity = latestData[1];\n                        break;\n                    case 'active':\n                        self.ctx.$scope.isActive = latestData[1] === true || latestData[1] === 'true';\n                        self.ctx.$scope.statusText = self.ctx.$scope.isActive ? 'Active' : 'Offline';\n                        break;\n                }\n                \n                if (latestData[0]) {\n                    self.ctx.$scope.lastActivity = new Date(latestData[0]);\n                }\n            }\n        }\n        self.ctx.detectChanges();\n    }\n};\n\nself.onDestroy = function() {\n};"
    },
    {
      "isSystemType": false,
      "bundleAlias": "fertirega_widgets",
      "typeAlias": "fertirega_timepicker",
      "type": "static",
      "title": "FertiRega Time Picker",
      "description": "Time picker for scheduling valve operations",
      "image": null,
      "sizeX": 6,
      "sizeY": 4,
      "resources": [],
      "templateHtml": "<div class=\"timepicker-container\">\n  <h3>Schedule Valve Operation</h3>\n  <div class=\"schedule-form\">\n    <div class=\"form-row\">\n      <label>Valve:</label>\n      <select ng-model=\"scheduleValve\">\n        <option value=\"0\">Valve 0</option>\n        <option value=\"1\">Valve 1</option>\n      </select>\n    </div>\n    <div class=\"form-row\">\n      <label>Start Time:</label>\n      <input type=\"datetime-local\" ng-model=\"startTime\">\n    </div>\n    <div class=\"form-row\">\n      <label>Duration (minutes):</label>\n      <input type=\"number\" ng-model=\"duration\" min=\"1\" max=\"1440\">\n    </div>\n    <div class=\"form-row\">\n      <label>Repeat:</label>\n      <select ng-model=\"repeatMode\">\n        <option value=\"none\">No Repeat</option>\n        <option value=\"daily\">Daily</option>\n        <option value=\"weekly\">Weekly</option>\n      </select>\n    </div>\n    <button class=\"schedule-button\" ng-click=\"sendSchedule()\">Send Schedule</button>\n  </div>\n  <div class=\"schedule-info\">\n    <p class=\"info-text\">Note: Configure the schedule command format in the widget settings</p>\n  </div>\n</div>",
      "templateCss": ".timepicker-container {\n  padding: 20px;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  height: 100%;\n}\n\n.timepicker-container h3 {\n  margin: 0 0 20px 0;\n  font-size: 16px;\n  color: #333;\n}\n\n.schedule-form {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.form-row {\n  display: flex;\n  flex-direction: column;\n}\n\n.form-row label {\n  font-size: 12px;\n  color: #666;\n  margin-bottom: 4px;\n}\n\n.form-row input,\n.form-row select {\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.schedule-button {\n  margin-top: 12px;\n  padding: 10px 20px;\n  background: #4caf50;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  font-size: 14px;\n  cursor: pointer;\n  transition: background 0.3s;\n}\n\n.schedule-button:hover {\n  background: #45a049;\n}\n\n.schedule-info {\n  margin-top: 16px;\n  padding: 12px;\n  background: #fff3cd;\n  border-radius: 4px;\n  border-left: 4px solid #ffc107;\n}\n\n.info-text {\n  margin: 0;\n  font-size: 11px;\n  color: #856404;\n}",
      "controllerScript": "self.onInit = function() {\n    self.ctx.$scope.scheduleValve = '0';\n    self.ctx.$scope.startTime = null;\n    self.ctx.$scope.duration = 60;\n    self.ctx.$scope.repeatMode = 'none';\n    \n    self.ctx.$scope.sendSchedule = function() {\n        // Get device EUI\n        var devEui = self.ctx.defaultSubscription.entityId.id;\n        \n        if (self.ctx.datasources && self.ctx.datasources[0] && self.ctx.datasources[0].entity) {\n            var entity = self.ctx.datasources[0].entity;\n            if (entity.name && entity.name.startsWith('eui-')) {\n                devEui = entity.name.replace('eui-', '');\n            }\n        }\n        \n        if (!self.ctx.$scope.startTime) {\n            self.ctx.showErrorToast('Please select a start time');\n            return;\n        }\n        \n        // TODO: Customize this payload format based on your device's scheduling protocol\n        // This is a placeholder that needs to be updated with your specific format\n        var scheduleData = {\n            valve: parseInt(self.ctx.$scope.scheduleValve),\n            startTime: new Date(self.ctx.$scope.startTime).getTime(),\n            duration: parseInt(self.ctx.$scope.duration),\n            repeat: self.ctx.$scope.repeatMode\n        };\n        \n        // Encode to base64 (you'll need to customize this based on your protocol)\n        var dataStr = JSON.stringify(scheduleData);\n        var base64 = btoa(dataStr);\n        \n        var payload = {\n            queueItem: {\n                confirmed: true,\n                data: base64,\n                fPort: 3  // Using fPort 3 for scheduling (change if needed)\n            }\n        };\n        \n        var url = 'http://100.92.66.20:8080/api/devices/' + devEui + '/queue';\n        \n        self.ctx.http.post(url, payload, {\n            headers: {\n                'Content-Type': 'application/json',\n                'Grpc-Metadata-Authorization': 'Bearer YOUR_API_KEY_HERE'\n            }\n        }).subscribe(\n            function(response) {\n                self.ctx.showSuccessToast('Schedule sent successfully');\n            },\n            function(error) {\n                self.ctx.showErrorToast('Failed to send schedule: ' + error.message);\n            }\n        );\n    };\n};\n\nself.onDataUpdated = function() {\n};\n\nself.onDestroy = function() {\n};"
    },
    {
      "isSystemType": false,
      "bundleAlias": "fertirega_widgets",
      "typeAlias": "fertirega_resetclock",
      "type": "RPC",
      "title": "FertiRega Reset Clock",
      "description": "Reset device clock/timer functionality",
      "image": null,
      "sizeX": 3,
      "sizeY": 2,
      "resources": [],
      "templateHtml": "<div class=\"reset-clock-container\">\n  <h4>Device Clock</h4>\n  <div class=\"clock-info\">\n    <p>Device Time: {{deviceTime | date:'medium'}}</p>\n    <p>Server Time: {{serverTime | date:'medium'}}</p>\n  </div>\n  <button class=\"reset-button\" ng-click=\"resetClock()\">Sync Clock</button>\n</div>",
      "templateCss": ".reset-clock-container {\n  padding: 16px;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.reset-clock-container h4 {\n  margin: 0 0 12px 0;\n  font-size: 14px;\n  color: #333;\n}\n\n.clock-info {\n  width: 100%;\n  margin-bottom: 12px;\n}\n\n.clock-info p {\n  margin: 4px 0;\n  font-size: 11px;\n  color: #666;\n}\n\n.reset-button {\n  padding: 8px 16px;\n  background: #2196f3;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: background 0.3s;\n}\n\n.reset-button:hover {\n  background: #1976d2;\n}",
      "controllerScript": "self.onInit = function() {\n    self.ctx.$scope.deviceTime = new Date();\n    self.ctx.$scope.serverTime = new Date();\n    \n    // Update server time every second\n    var timeInterval = setInterval(function() {\n        self.ctx.$scope.serverTime = new Date();\n        self.ctx.detectChanges();\n    }, 1000);\n    \n    self.ctx.$scope.resetClock = function() {\n        var devEui = self.ctx.defaultSubscription.entityId.id;\n        \n        if (self.ctx.datasources && self.ctx.datasources[0] && self.ctx.datasources[0].entity) {\n            var entity = self.ctx.datasources[0].entity;\n            if (entity.name && entity.name.startsWith('eui-')) {\n                devEui = entity.name.replace('eui-', '');\n            }\n        }\n        \n        // Send clock sync command\n        var timestamp = Math.floor(Date.now() / 1000);\n        var buffer = new Uint8Array(4);\n        buffer[0] = (timestamp >> 24) & 0xFF;\n        buffer[1] = (timestamp >> 16) & 0xFF;\n        buffer[2] = (timestamp >> 8) & 0xFF;\n        buffer[3] = timestamp & 0xFF;\n        \n        var base64 = btoa(String.fromCharCode.apply(null, buffer));\n        \n        var payload = {\n            queueItem: {\n                confirmed: true,\n                data: base64,\n                fPort: 4  // Using fPort 4 for clock sync\n            }\n        };\n        \n        var url = 'http://100.92.66.20:8080/api/devices/' + devEui + '/queue';\n        \n        self.ctx.http.post(url, payload, {\n            headers: {\n                'Content-Type': 'application/json',\n                'Grpc-Metadata-Authorization': 'Bearer YOUR_API_KEY_HERE'\n            }\n        }).subscribe(\n            function(response) {\n                self.ctx.showSuccessToast('Clock sync command sent');\n                self.ctx.$scope.deviceTime = new Date();\n            },\n            function(error) {\n                self.ctx.showErrorToast('Failed to sync clock: ' + error.message);\n            }\n        );\n    };\n    \n    self.ctx.$scope.$on('$destroy', function() {\n        clearInterval(timeInterval);\n    });\n};\n\nself.onDataUpdated = function() {\n};\n\nself.onDestroy = function() {\n};"
    }
  ]
}